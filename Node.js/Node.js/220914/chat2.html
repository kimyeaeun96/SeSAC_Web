<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
        <style>

        </style>
    </head>
    <body>
        <div id="chat-list" class="chat-list">
        </div>
        <select id="nick-list">
            <option value="전체"></option>
        </select>
        <input type="text" id="message">
        <button type="button" onclick="send();">전송</button>
        <script>
            var nickname = prompt("닉네임 입력");
            var socket = io.connect();
            socket.emit("info2", {nickname: nickname}); 
            // socket.on("info2", function(data){ console.log(data) id = data;}) id ??

            // 메세지 send
            function send(){
                let msg = document.getElementById('message').value;   // 메세지 불러오기
                let nick = document.getElementById('nick-list'); // 닉네임 리스트 불러오기
                socket.emit("send", { msg: msg, to: nick });    // socket.on("send", function(data){ console.log(data)}) -> data.msg, data.nick
                document.getElementById("message").value = ""; // ?? 
            }
            socket.on("newMessage", function(data){ // 메세지 data 읽기 : chat-list, 
                console.log(data);
                let chat_list = document.getElementById('chat-list');
                let div = document.createElement("div");
                let div_chat = document.createElement("div");
                var span = document.createElement("span");

                div_chat.textContent = data.msg;
                // <.chat_list><div><div_chat>{data.msg}</div_chat></div></.chat_list>

                if ( data.is_dm ) div_chat.textContent = "(DM)" + div_chat.textContent; // is_dm: true의 경우: <.div_chat>(DM) + {div_chat} </.div_chat>
                if ( data.nickname == nickname ){div.classList.add("my-chat");} // nickname: true -> <div><div class="my-chat"></div></div>
                else{   // is_dm: false, nickname: false -> <div><span class="other-chat">{nickname}</span></div>
                    span.textContent = data.nickname;
                    div.appendChild(span);
                    div.classList.add("other-chat");
                    div.appendChild(div_chat);
                    chat_list.appendChild(div);
                }
                //<div class="other-chat"><span>닉네임</span><div class="div_chat"></div></div>
            })
            // chat-list에 유저입장 알림 div 생성
            socket.on("notice", function(data){
                let chat_list = document.getElementById("chat-list"); // chat-list 불러옴
                let div = document.createElement("div"); // div 생성
                div.textContent = data; // <div>{data}</div>
                
                chat_list.appendChild(div); //<.chat-list><div></div><div></div> ... </.chat-list>
            });
            //닉네임 리스트
            socket.on("list", function(list){
                let nick_list = document.getElementById("nick-list"); // 닉네임리스트를 부른다
                while (nick_list.firstChild){
                    nick_list.removeChild(nick_list.lastChild); // 라스트차일드부터 지운다. 전부 지워지면 while문 종료
                }
                let option = document.createElement("option") // 닉네임리스트에 넣을 옵션을 create 함. 계속 추가하도록 appendChild
                option.text = "전체";
                option.value = "전체";
                nick_list.appendChild( option );

                for ( let [key, value] of Object.entries(list) ){   // option의 정보
                    let option = document.createElement('option');
                    option.text = value;
                    option.value = value;
                    nick_list.appendChild( option );
                }
            });
        </script>
    </body>
</html>